<!DOCTYPE html>
<html lang="en" layout:decorate="~{include/user}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">

<div layout:fragment="content">
<!-- /* view 화면 html 코드 작성 부분 */ -->
  <div class="page_title mb-4">
    <a href="/sitter/list" class="d-inline-flex align-items-baseline">
      <small class="text-danger">돌보미 게시판 <i class="fa-solid fa-chevron-right fs-xs"></i></small>
    </a>
    <h3 class="memomentKkukkkuk fw-normal mt-2">게시글 작성</h3>
  </div>
  <div class="board_area">
    <form action="/sitter/register" method="post" enctype="multipart/form-data">
      <div id="hiddenWrap"></div>
      <div class="mb-2">
        <select name="category" id="category" class="form-select w-auto" required>
          <option value="" hidden>카테고리(필수)</option>
          <option value="구해요">구하고 싶어요</option>
          <option value="일해요">일하고 싶어요</option>
        </select>
      </div>
      <div class="mb-2">
        <select name="petInfo" id="petInfo" class="form-select">
          <option value="">돌봄이 필요한 아이는</option>
          <option value="dog">강아지</option>
          <option value="cat">고양이</option>
        </select>
      </div>
      <div class="mb-2">
        <div class="d-flex align-items-center gap-1">
          <select name="sido" id="sido" class="form-select" required>
            <option value="" data-sido-id="">시/도</option>
          </select>
          <select name="sigungu" id="sigungu" class="form-select" disabled required>
            <option value="">시/군/구</option>
          </select>
        </div>
      </div>
      <div class="mb-2">
        <input type="text" name="title" class="form-control" placeholder="제목을 입력해주세요" required>
      </div>
      <div class="mb-2">
        <textarea name="content" id="content" cols="30" rows="10" class="form-control" placeholder="시간과 장소 및 급여를 자세히 알려주세요!(최대 1000자)" required ></textarea>
      </div>
      <div class="mb-3">
        <input type="file" name="files" class="form-control" multiple>
      </div>
      <div class="button_wrap">
        <div class="row g-2">
          <div class="col-6 col-md-auto ms-md-auto">
            <a href="/sitter/list" class="btn btn-lg btn-gray w-100">취소</a>
          </div>
          <div class="col-6 col-md-auto">
            <button class="btn btn-lg btn-main w-100">저장</button>
          </div>
        </div>
      </div>
    </form>
  </div>
<!-- /* //view 화면 html 코드 작성 끝 */ -->
</div>

<script layout:fragment="pagescript" th:inline="javascript">
  /////// 카테고리 및 타입 설정 ///////
  const cate = document.getElementById("category")
  const petInfo = document.getElementById("petInfo")
  const hiddenWrap = document.getElementById("hiddenWrap")
  cate.addEventListener("change", function(e){
      console.log(e.target.value)
      let val = e.target.value
      if (val === "일해요") {
        petInfo.classList.remove("d-block")
        petInfo.classList.add("d-none")
        petInfo.value = ''
        hiddenWrap.innerHTML = `<input type="hidden" id="state" name="state" value="구직중">`
      } else {
          petInfo.classList.remove("d-none")
          petInfo.classList.add("d-block")
          hiddenWrap.innerHTML = `<input type="hidden" id="state" name="state" value="구인중">`
      }
  })


  /////// 시도,시군구 정보 초기화 ///////
  const sido = document.querySelector("#sido")
  const sigungu = document.querySelector("#sigungu")

  async function loadSido(){
      const {data} = await axios.get('/api/regions/sido');
      sido.innerHTML = `<option value="">시/도</option>` +
          data.map(s=>`<option value="${s.name}" data-sido-id="${s.id}">${s.name}</option>`).join('');
  }
  async function loadSigungu(sidoId) {
      if (!sidoId) {
          sigungu.innerHTML = '<option value="">시/군/구</option>';
          sigungu.disabled = true;
          return;
      }
      const { data } = await axios.get('/api/regions/sigungu', { params: { sidoId } });
      sigungu.innerHTML = '<option value="">시/군/구</option>' +
          data.map(g => `<option value="${g.name}">${g.name}</option>`).join('');
      sigungu.disabled = false;
  }
  sido.addEventListener('change', (e) => {
      const selectedOption = e.target.selectedOptions[0]; // 선택된 <option> 요소
      const sidoId = selectedOption.dataset.sidoId;       // data-sidoid 값 읽기
      loadSigungu(sidoId);
  });

  loadSido()
</script>